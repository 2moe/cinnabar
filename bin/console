#!/usr/bin/env -S ruby --disable=gems
# rubocop:disable Style/MixinUsage
# rubocop:disable Naming/HeredocDelimiterNaming
# rubocop:disable Style/SpecialGlobalVars
# frozen_string_literal: true

%w[gem_path utils]
  .each { require_relative "../lib/cinnabar/#{_1}" }

-> {
  gems = %w[
    rdoc reline irb argvise logger sinlog
  ].tap { _1 << 'fiddle' if Cinnabar::Utils::OS.windows? }

  {
    cache_dir: __dir__,
    cache_file: '../load_path.json',
    gems:,
  }
    .then(&Cinnabar.new_gem_path_proc)
    .append_load_path!

  gems.each { require _1 }
}.call

require 'argvise'
require 'sinlog'
require 'irb'

require_relative '../lib/cinnabar'

include Sinlog::Mixin
include Argvise::HashMixin

-> {
  # red = "\e[31m"
  green = "\e[32m"
  # yellow = "\e[33m"
  blue = "\e[34m"
  magenta = "\e[35m"
  # cyan = "\e[36m"
  reset = "\e[0m"

  'You can manually load the following modules:'.log_info
  %w[
    FnPipe::Mixin
    Command::ArrMixin
    Command::TaskArrMixin
    Downloader::StrMixin
    StrToPath::Mixin
  ].map { "#{green}include #{magenta}Cinnabar::#{blue}#{_1}" }
    .join("\n")
    .tap(&:display)
  Kernel.warn reset
}.call

IRB.start

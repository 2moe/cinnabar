#!/usr/bin/env -S ruby --disable=gems
# rubocop:disable Style/MixinUsage
# rubocop:disable Naming/HeredocDelimiterNaming
# frozen_string_literal: true

$: << File.expand_path('../misc/download', __dir__)

-> {
  return if RUBY_VERSION.split('.').first.to_i <= 3

  require_relative '../lib/cinnabar/path'
  cache_file = File.expand_path('../load_path.txt', __dir__)
  append_path = ->(pkg) {
    Cinnabar::Path.find_and_append_load_path(pkg, cache_file:)
  }

  %w[irb reline logger].each(&append_path)
}.call

require 'irb'
require 'argvise'
require 'sinlog'

require_relative '../lib/cinnabar'

include Sinlog::Mixin
include Argvise::HashMixin

-> {
  # red = "\e[31m"
  green = "\e[32m"
  # yellow = "\e[33m"
  blue = "\e[34m"
  magenta = "\e[35m"
  # cyan = "\e[36m"
  reset = "\e[0m"

  puts 'You can manually load the following modules:'
  %w[
    FnPipe::Mixin
    Command::ArrMixin
    Command::TaskArrMixin
    Downloader::StrMixin
    StrToPath::Mixin
  ].map { "#{green}include #{magenta}Cinnabar::#{blue}#{_1}\n" }
    .each(&:display)
  puts reset
}.call

IRB.start

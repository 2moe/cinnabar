#!/usr/bin/env ruby
# frozen_string_literal: true

require 'argvise'
require 'cinnabar'

using Argvise::HashRefin
using Cinnabar::Command::ArrRefin

def merge_main
  {
    git: (),
    merge: (),
    "allow-unrelated-histories": true,
    squash: true,
    X: 'theirs',
    main: (),
  }
    .to_argv
    .run_cmd
end

system 'git fetch origin'
case `git rev-parse --abbrev-ref HEAD`.chomp
  when 'main' then ()
  else merge_main
end
